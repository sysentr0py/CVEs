<b><h2>Description</b></h2>

In LimeSurvey <= v6.6.2, the Kcfinder file manager uses the 'js_localize.php' function to set the user's language by taking the language file name from the 'lng' query string parameter, without properly sanitizing it. This allows an attacker to specify an arbitrary file to include and execute them, resulting in a Local File Inclusion vulnerability.

Note: The vulnerability has not been fixed by the vendor, so future versions of LimeSurvey are likely to be affected as well.

<b><h2>PoC</b></h2>

To exploit this vulnerability, follow the steps below:

1. Add the line 'gethostbyname('your-domain.com')' in a php file (e.g.: /var/www/limesurvey/vendor/kcfinder/conf/conf.php) that you'd like to include.



![lfi_2](https://github.com/user-attachments/assets/f7eed04d-066c-4bfb-a064-6c16fa07b5e7)



2. Send a GET request to the '/vendor/kcfinder/js_localize.php?lng=<payload>' URI, by specifying the path of the file you want to include as payload (e.g.: '..%2F..%2Fconf/config.php')



![lfi_3](https://github.com/user-attachments/assets/c979047c-fdc5-43d9-b4be-e58ebc4226df)



Note: To include the 'config.php' file, you need to use the 'slash notation' (../) to move the directories from the default '/lang' directory set in the ['js_localize.php'](https://github.com/sysentr0py/LimeSurvey/blob/3dd5749b299afd468e450d2bab9d05c2d65443d2/vendor/kcfinder/js_localize.php#L26) file to the '/conf' directory.



3. The 'config.php' file will be executed and trigger the DNS lookup to the Burp Collaborator .


![lfi_4](https://github.com/user-attachments/assets/f61e91a1-1724-4d15-a9ec-f8f2b81c87b3)



<b><h2>References</b></h2>
- [https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-42902](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-42902)
- [https://github.com/LimeSurvey/LimeSurvey/blob/6434b12ded1c4b6516200c453441d0896e11eee0/vendor/kcfinder/js_localize.php#L26](https://github.com/LimeSurvey/LimeSurvey/blob/6434b12ded1c4b6516200c453441d0896e11eee0/vendor/kcfinder/js_localize.php#L26)
